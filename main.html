<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>æ‡·èˆŠç«¥å¹´å¡é€šæ·˜æ±°è³½</title>
<link rel="icon" href="5453.png">
<style>
    body {
        background: #f5f0e6;
        font-family: "Microsoft JhengHei", sans-serif;
        text-align: center;
        padding: 20px;
    }

    h1 { margin-bottom: 20px; }
    h2 { margin-top: 10px; }

    #roundInfo {
        font-size: 20px;
        margin-top: 10px;
        color: #555;
    }

    #container {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-top: 40px;
    }

    .card {
        width: 35%;
        cursor: pointer;
        transition: 0.3s;
    }

    .card:hover {
        transform: scale(1.05);
    }

    img {
        width: 100%;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    #winner {
        display: none;
        margin-top: 50px;
    }

    #winner img {
        width: 60%;
    }

    #winner h2 {
        font-size: 34px;
        margin-top: 20px;
        color: #d62828;
    }
</style>
</head>
<body>

<h1>æ‡·èˆŠç«¥å¹´å¡é€šæ·˜æ±°è³½</h1>
<h2 id="roundInfo"></h2>

<div id="container">
    <div id="left" class="card"><img src=""></div>
    <div id="right" class="card"><img src=""></div>
</div>

<div id="winner">
    <h1>ğŸ‰ æœ€çµ‚å† è»ï¼ ğŸ‰</h1>
    <img id="winnerImg" src="">
    <h2 id="winnerText"></h2>
</div>

<script>
// ------------------------------------------------------------
// 1. å°‡ä½ çš„ 46 å¼µåœ–ç‰‡æ”¾å…¥é€™è£¡
// ï¼ˆç¤ºç¯„å‰ 6 å¼µï¼Œä½ è«‹è£œæ»¿ 46 å¼µï¼‰
// ------------------------------------------------------------
let allImages = [
    { name: "å“†å•¦Aå¤¢", src: "images/doraemon.jpg" },
    { name: "ç¾å°‘å¥³æˆ°å£«", src: "images/sailormoon.jpg" },
    { name: "ä¸ƒé¾ç ", src: "images/dbz.jpg" },
    { name: "åº«æ´›é­”æ³•ä½¿", src: "images/ccs.jpg" },
    { name: "è Ÿç­†å°æ–°", src: "images/shinchan.jpg" },
    { name: "ååµæ¢æŸ¯å—", src: "images/conan.jpg" },

    // === ä½ åœ¨é€™è£¡ç¹¼çºŒåŠ åˆ°å…± 46 å¼µ ===

];

// ------------------------------------------------------------
// æ·˜æ±°è³½éšæ®µè¨­å®š
// 46 â†’ 16 â†’ 4 â†’ 1
// ------------------------------------------------------------
const ROUND_STEPS = [46, 16, 4, 1];
let currentRoundIndex = 0;
let candidatePool = [];   // æœ¬è¼ªåƒè³½è€…
let winnersNextRound = []; // æ¯è¼ªå‹å‡ºçš„é€²å…¥ä¸‹ä¸€è¼ª
let queue = []; // å‡ºå ´é †åº
let currentA = null;
let currentB = null;

// ------------------------------------------------------------
// å·¥å…·ï¼šæ´—ç‰Œ
// ------------------------------------------------------------
function shuffle(arr) {
    return arr.sort(() => Math.random() - 0.5);
}

// ------------------------------------------------------------
// å•Ÿå‹•æ¯”è³½
// ------------------------------------------------------------
function startRound() {
    let target = ROUND_STEPS[currentRoundIndex];

    if (currentRoundIndex === 0) {
        // ç¬¬ä¸€è¼ªï¼šå¾å…¨éƒ¨é–‹å§‹
        candidatePool = shuffle([...allImages]);
    } else {
        // å¾ŒçºŒè¼ªï¼šç”¨ä¸Šä¸€è¼ªè´å®¶
        candidatePool = shuffle([...winnersNextRound]);
        winnersNextRound = []; // é‡ç½®ç‚ºä¸‹ä¸€è¼ªçš„å­˜æ”¾å€
    }

    queue = [...candidatePool]; // åˆå§‹åŒ–å°æˆ°éšŠåˆ—
    currentA = null;
    currentB = null;

    updateRoundText();
    drawTwo();
}

// ------------------------------------------------------------
// é¡¯ç¤ºç•¶å‰è¼ªæ¬¡è³‡è¨Š
// ------------------------------------------------------------
function updateRoundText() {
    let t = ROUND_STEPS[currentRoundIndex];
    if (t === 46) document.getElementById("roundInfo").innerText = "ç¬¬ 1 è¼ªï¼š46 å¼· â†’ 16 å¼·";
    if (t === 16) document.getElementById("roundInfo").innerText = "ç¬¬ 2 è¼ªï¼š16 å¼· â†’ 4 å¼·";
    if (t === 4)  document.getElementById("roundInfo").innerText = "ç¬¬ 3 è¼ªï¼š4 å¼· â†’ å† è»";
    if (t === 1)  document.getElementById("roundInfo").innerText = "æœ€çµ‚æ±ºæˆ°";
}

// ------------------------------------------------------------
// æŠ½å…©å¼µåœ–ç‰‡å‡ºä¾† PK
// ------------------------------------------------------------
function drawTwo() {
    // æœ¬è¼ªå·²åªå‰©ä¸€å€‹ â†’ æœ¬è¼ªçµæŸ
    if (queue.length === 0 && currentA !== null && currentB === null) {
        winnersNextRound.push(currentA);

        currentRoundIndex++;

        // é€²å…¥ä¸‹ä¸€è¼ª
        if (currentRoundIndex < ROUND_STEPS.length - 1) {
            startRound();
        } else {
            // æœ€çµ‚å‰© 1 å¼µ â†’ å† è»
            showWinner(currentA);
        }
        return;
    }

    // åˆå§‹åŒ– A
    if (!currentA) {
        currentA = queue.shift();
    }

    // B å¿…é ˆå¾ queue è£œå……
    currentB = queue.shift();

    // é¡¯ç¤º
    document.querySelector("#left img").src = currentA.src;
    document.querySelector("#right img").src = currentB.src;
}

// ------------------------------------------------------------
// ä½¿ç”¨è€…é¸æ“‡å‹è€…
// ------------------------------------------------------------
function pick(winner, loser) {
    // å„ªå‹ç•™ä¸‹åœ¨ A
    currentA = winner;

    // è¼¸çš„æ·˜æ±°
    // ä¸å†ä½¿ç”¨

    // è‹¥æ²’æœ‰ B å¯è£œï¼Œå°±é€²å…¥ drawTwo çµç®—åˆ¤æ–·
    if (queue.length > 0) {
        currentB = queue.shift();
    } else {
        currentB = null;
    }

    // è‹¥ Bç‚º nullï¼Œä¸” queue ä¹Ÿç©º â†’ æ­¤è¼ªçµæŸ
    if (currentB === null && queue.length === 0) {
        winnersNextRound.push(currentA);
        currentA = null;
        currentB = null;

        currentRoundIndex++;

        if (currentRoundIndex < ROUND_STEPS.length - 1) {
            startRound();
        } else {
            showWinner(winnersNextRound[0]);
        }
        return;
    }

    drawTwo();
}

// ------------------------------------------------------------
// é»æ“Šå·¦å³åœ–ç‰‡é€²è¡ŒæŠ•ç¥¨
// ------------------------------------------------------------
document.getElementById("left").onclick = () => pick(currentA, currentB);
document.getElementById("right").onclick = () => pick(currentB, currentA);

// ------------------------------------------------------------
// é¡¯ç¤ºå† è»
// ------------------------------------------------------------
function showWinner(w) {
    document.getElementById("container").style.display = "none";
    document.getElementById("winner").style.display = "block";
    document.getElementById("roundInfo").style.display = "none";

    document.getElementById("winnerImg").src = w.src;
    document.getElementById("winnerText").innerText = "å† è»æ˜¯ï¼šã€Œ" + w.name + "ã€ï¼";
}

// ------------------------------------------------------------
// é–‹å§‹ç¬¬ä¸€è¼ª
// ------------------------------------------------------------
startRound();
</script>

</body>
</html>
